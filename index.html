<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Smart Study Schedule</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- React -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f1f3f6}
.app{max-width:480px;margin:auto;background:#fff;min-height:100vh;display:flex;flex-direction:column}
header{background:#1976d2;color:white;padding:14px;text-align:center;font-weight:bold}
.content{flex:1;padding:12px}
.card{background:#fff;padding:12px;border-radius:10px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.15)}
input,select,button{width:100%;padding:8px;margin:4px 0}
button{background:#1976d2;color:white;border:none;border-radius:6px}
.small{padding:4px;font-size:12px}
.danger{background:#d32f2f}
.done{text-decoration:line-through;color:green}
.nav{display:flex;border-top:1px solid #ccc}
.nav button{flex:1;border:none;padding:10px}
.nav .active{background:#1976d2;color:white}
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
/* üî• GANTI DENGAN FIREBASE CONFIG KAMU */
const firebaseConfig={
 apiKey:"AIzaSyCJBHrpUrlkn4zIv_yeZzMEyECs084Lq3c",
 authDomain:"smart-study-schedule-ac494.firebaseapp.com",
 projectId:"smart-study-schedule-ac494",
 storageBucket: "smart-study-schedule-ac494.firebasestorage.app",
 messagingSenderId: "199494524267",
 appId:"1:199494524267:web:35d555c2527dc73ea3802e"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

const {useState,useEffect}=React;

function App(){
const days=["Senin","Selasa","Rabu","Kamis","Jumat"];
const [user,setUser]=useState(null);
const [tab,setTab]=useState("jadwal");
const [email,setEmail]=useState("");
const [password,setPassword]=useState("");
const [mode,setMode]=useState("login");

const [schedule,setSchedule]=useState([]);
const [tasks,setTasks]=useState([]);

const [formJadwal,setFormJadwal]=useState({day:"Senin",subject:"",start:"",end:""});
const [formTask,setFormTask]=useState({title:"",date:"",time:""});

useEffect(()=>{
auth.onAuthStateChanged(u=>{
setUser(u);
if(u) loadData(u.uid);
});
},[]);

useEffect(()=>{
if("Notification"in window && Notification.permission==="default"){
Notification.requestPermission();
}
},[]);

// NOTIFIKASI
useEffect(()=>{
const interval=setInterval(()=>{
const now=new Date();
const today=now.toISOString().split("T")[0];
const timeNow=now.toTimeString().slice(0,5);

// Tugas
tasks.forEach(t=>{
if(!t.done && t.date===today && t.time===timeNow){
new Notification("‚è∞ Waktu Mengerjakan Tugas",{body:t.title});
}
});

// Jadwal
schedule.forEach(s=>{
const [h,m]=s.start.split(":");
const notif=new Date();
notif.setHours(h);
notif.setMinutes(m-1);
if(
notif.getHours()===now.getHours() &&
notif.getMinutes()===now.getMinutes()
){
new Notification("üìö Pelajaran Akan Dimulai",{body:s.subject});
}
});
},30000);
return()=>clearInterval(interval);
},[schedule,tasks]);

const loadData=async(uid)=>{
const s=await db.collection("users").doc(uid).collection("schedule").get();
setSchedule(s.docs.map(d=>({...d.data(),id:d.id})));
const t=await db.collection("users").doc(uid).collection("tasks").get();
setTasks(t.docs.map(d=>({...d.data(),id:d.id})));
};

const login=()=>auth.signInWithEmailAndPassword(email,password);
const register=()=>auth.createUserWithEmailAndPassword(email,password);
const logout=()=>auth.signOut();
const loginGoogle = async () => {
  const provider = new firebase.auth.GoogleAuthProvider();

  try {
    const result = await auth.signInWithPopup(provider);
    const user = result.user;

    await db.collection("users").doc(user.uid).set({
      nama: user.displayName,
      email: user.email,
      login: "google",
      lastLogin: new Date()
    }, { merge: true });

  } catch (err) {
    alert(err.message);
  }

// CRUD
const addJadwal=async()=>{
await db.collection("users").doc(user.uid)
.collection("schedule").add(formJadwal);
setFormJadwal({day:"Senin",subject:"",start:"",end:""});
loadData(user.uid);
};
const delJadwal=async(id)=>{
await db.collection("users").doc(user.uid)
.collection("schedule").doc(id).delete();
loadData(user.uid);
};

const addTask=async()=>{
await db.collection("users").doc(user.uid)
.collection("tasks").add({...formTask,done:false});
setFormTask({title:"",date:"",time:""});
loadData(user.uid);
};
const toggleTask=async(t)=>{
await db.collection("users").doc(user.uid)
.collection("tasks").doc(t.id).update({done:!t.done});
loadData(user.uid);
};
 
if(!user){
return(
<div className="app">
<header>Login Siswa</header>
<div className="content">
<div className="card">
<input placeholder="Email" onChange={e=>setEmail(e.target.value)}/>
<input type="password" placeholder="Password" onChange={e=>setPassword(e.target.value)}/>
<button onClick={mode==="login"?login:register}>
{mode==="login"?"Login":"Daftar"}
</button>
<button onClick={loginGoogle}>
  Login dengan Google
<button onClick={()=>setMode(mode==="login"?"register":"login")}>
{mode==="login"?"Buat Akun":"Sudah Punya Akun"}
<button
  onClick={loginGoogle}
  style={{
    backgroundColor: "#db4437",
    color: "white",
    marginTop: "10px"
  }}
</button>
</div>
</div>
</div>
);
}
     
};
return(
<div className="app">
<header>Smart Study Schedule <button onClick={logout}>Logout</button></header>

<div className="content">
{tab==="jadwal" && (
<div className="card">
<h3>Tambah Jadwal</h3>
<select value={formJadwal.day} onChange={e=>setFormJadwal({...formJadwal,day:e.target.value})}>
{days.map(d=><option key={d}>{d}</option>)}
</select>
<input placeholder="Mata pelajaran" value={formJadwal.subject}
onChange={e=>setFormJadwal({...formJadwal,subject:e.target.value})}/>
<input type="time" value={formJadwal.start}
onChange={e=>setFormJadwal({...formJadwal,start:e.target.value})}/>
<input type="time" value={formJadwal.end}
onChange={e=>setFormJadwal({...formJadwal,end:e.target.value})}/>
<button onClick={addJadwal}>Tambah</button>

<ul>
{schedule.map(s=>(
<li key={s.id}>
{s.day} - {s.subject} ({s.start}-{s.end})
<button className="small danger" onClick={()=>delJadwal(s.id)}>‚ùå</button>
</li>
))}
</ul>
</div>
)}

{tab==="tugas" && (
<div className="card">
<h3>Tugas / Ujian</h3>
<input placeholder="Nama tugas" value={formTask.title}
onChange={e=>setFormTask({...formTask,title:e.target.value})}/>
<input type="date" value={formTask.date}
onChange={e=>setFormTask({...formTask,date:e.target.value})}/>
<input type="time" value={formTask.time}
onChange={e=>setFormTask({...formTask,time:e.target.value})}/>
<button onClick={addTask}>Tambah</button>

<ul>
{tasks.map(t=>(
<li key={t.id} className={t.done?"done":""}
onClick={()=>toggleTask(t)}>
{t.title} ({t.date} {t.time})
</li>
))}
</ul>
</div>
)}
</div>

<div className="nav">
<button className={tab==="jadwal"?"active":""} onClick={()=>setTab("jadwal")}>üìÖ Jadwal</button>
<button className={tab==="tugas"?"active":""} onClick={()=>setTab("tugas")}>üìù Tugas</button>
</div>
</div>
);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
